import{_ as $e,r as b,c as ee,J as Le,z as Te,o as Oe,K as Se,j as v,h as u,i as a,w as f,f as C,k as z,F as X,y as K,L as Ie,t as k,x as Re,E as D,M as re,g as p,l as $,v as Ue,N as ie,O as Ne,n as ue,p as Y,P as Ae,e as ce,a as Be,Q as Fe,A as He}from"./index-CNVEcACA.js";import{l as Xe}from"./index-BLRFddlS.js";import{u as J}from"./index.es-AM15teyr.js";import{_ as N}from"./request-CwFpdHqZ.js";var Q={exports:{}},Ke=Q.exports,_e;function Ye(){return _e||(_e=1,function(te,L){(function(y,i){te.exports=i()})(Ke,function(){return function(y){function i(l){if(r[l])return r[l].exports;var c=r[l]={i:l,l:!1,exports:{}};return y[l].call(c.exports,c,c.exports,i),c.l=!0,c.exports}var r={};return i.m=y,i.c=r,i.i=function(l){return l},i.d=function(l,c,w){i.o(l,c)||Object.defineProperty(l,c,{configurable:!1,enumerable:!0,get:w})},i.n=function(l){var c=l&&l.__esModule?function(){return l.default}:function(){return l};return i.d(c,"a",c),c},i.o=function(l,c){return Object.prototype.hasOwnProperty.call(l,c)},i.p="/dist-module/",i(i.s=3)}([function(y,i,r){var l=r(4)(r(1),r(5),null,null,null);y.exports=l.exports},function(y,i,r){Object.defineProperty(i,"__esModule",{value:!0});var l=r(2),c=function(n){return n&&n.__esModule?n:{default:n}}(l),w=function(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")};i.default={props:{search:{type:String,required:!1,default:""},emojiTable:{type:Object,required:!1,default:function(){return c.default}}},data:function(){return{display:{x:0,y:0,visible:!1}}},computed:{emojis:function(){if(this.search){var n={};for(var h in this.emojiTable){n[h]={};for(var x in this.emojiTable[h])new RegExp(".*"+w(this.search)+".*").test(x)&&(n[h][x]=this.emojiTable[h][x]);Object.keys(n[h]).length===0&&delete n[h]}return n}return this.emojiTable}},methods:{insert:function(n){this.$emit("emoji",n)},toggle:function(n){this.display.visible=!this.display.visible,this.display.x=n.clientX,this.display.y=n.clientY},hide:function(){this.display.visible=!1},escape:function(n){this.display.visible===!0&&n.keyCode===27&&(this.display.visible=!1)}},directives:{"click-outside":{bind:function(n,h,x){if(typeof h.value=="function"){var E=h.modifiers.bubble,g=function(_){(E||!n.contains(_.target)&&n!==_.target)&&h.value(_)};n.__vueClickOutside__=g,document.addEventListener("click",g)}},unbind:function(n,h){document.removeEventListener("click",n.__vueClickOutside__),n.__vueClickOutside__=null}}},mounted:function(){document.addEventListener("keyup",this.escape)},destroyed:function(){document.removeEventListener("keyup",this.escape)}}},function(y,i,r){Object.defineProperty(i,"__esModule",{value:!0}),i.default={"Frequently used":{thumbs_up:"👍","-1":"👎",sob:"😭",confused:"😕",neutral_face:"😐",blush:"😊",heart_eyes:"😍"},People:{smile:"😄",smiley:"😃",grinning:"😀",blush:"😊",wink:"😉",heart_eyes:"😍",kissing_heart:"😘",kissing_closed_eyes:"😚",kissing:"😗",kissing_smiling_eyes:"😙",stuck_out_tongue_winking_eye:"😜",stuck_out_tongue_closed_eyes:"😝",stuck_out_tongue:"😛",flushed:"😳",grin:"😁",pensive:"😔",relieved:"😌",unamused:"😒",disappointed:"😞",persevere:"😣",cry:"😢",joy:"😂",sob:"😭",sleepy:"😪",disappointed_relieved:"😥",cold_sweat:"😰",sweat_smile:"😅",sweat:"😓",weary:"😩",tired_face:"😫",fearful:"😨",scream:"😱",angry:"😠",rage:"😡",triumph:"😤",confounded:"😖",laughing:"😆",yum:"😋",mask:"😷",sunglasses:"😎",sleeping:"😴",dizzy_face:"😵",astonished:"😲",worried:"😟",frowning:"😦",anguished:"😧",imp:"👿",open_mouth:"😮",grimacing:"😬",neutral_face:"😐",confused:"😕",hushed:"😯",smirk:"😏",expressionless:"😑",man_with_gua_pi_mao:"👲",man_with_turban:"👳",cop:"👮",construction_worker:"👷",guardsman:"💂",baby:"👶",boy:"👦",girl:"👧",man:"👨",woman:"👩",older_man:"👴",older_woman:"👵",person_with_blond_hair:"👱",angel:"👼",princess:"👸",smiley_cat:"😺",smile_cat:"😸",heart_eyes_cat:"😻",kissing_cat:"😽",smirk_cat:"😼",scream_cat:"🙀",crying_cat_face:"😿",joy_cat:"😹",pouting_cat:"😾",japanese_ogre:"👹",japanese_goblin:"👺",see_no_evil:"🙈",hear_no_evil:"🙉",speak_no_evil:"🙊",skull:"💀",alien:"👽",hankey:"💩",fire:"🔥",sparkles:"✨",star2:"🌟",dizzy:"💫",boom:"💥",anger:"💢",sweat_drops:"💦",droplet:"💧",zzz:"💤",dash:"💨",ear:"👂",eyes:"👀",nose:"👃",tongue:"👅",lips:"👄",thumbs_up:"👍","-1":"👎",ok_hand:"👌",facepunch:"👊",fist:"✊",wave:"👋",hand:"✋",open_hands:"👐",point_up_2:"👆",point_down:"👇",point_right:"👉",point_left:"👈",raised_hands:"🙌",pray:"🙏",clap:"👏",muscle:"💪",walking:"🚶",runner:"🏃",dancer:"💃",couple:"👫",family:"👪",couplekiss:"💏",couple_with_heart:"💑",dancers:"👯",ok_woman:"🙆",no_good:"🙅",information_desk_person:"💁",raising_hand:"🙋",massage:"💆",haircut:"💇",nail_care:"💅",bride_with_veil:"👰",person_with_pouting_face:"🙎",person_frowning:"🙍",bow:"🙇",tophat:"🎩",crown:"👑",womans_hat:"👒",athletic_shoe:"👟",mans_shoe:"👞",sandal:"👡",high_heel:"👠",boot:"👢",shirt:"👕",necktie:"👔",womans_clothes:"👚",dress:"👗",running_shirt_with_sash:"🎽",jeans:"👖",kimono:"👘",bikini:"👙",briefcase:"💼",handbag:"👜",pouch:"👝",purse:"👛",eyeglasses:"👓",ribbon:"🎀",closed_umbrella:"🌂",lipstick:"💄",yellow_heart:"💛",blue_heart:"💙",purple_heart:"💜",green_heart:"💚",broken_heart:"💔",heartpulse:"💗",heartbeat:"💓",two_hearts:"💕",sparkling_heart:"💖",revolving_hearts:"💞",cupid:"💘",love_letter:"💌",kiss:"💋",ring:"💍",gem:"💎",bust_in_silhouette:"👤",speech_balloon:"💬",footprints:"👣"},Nature:{dog:"🐶",wolf:"🐺",cat:"🐱",mouse:"🐭",hamster:"🐹",rabbit:"🐰",frog:"🐸",tiger:"🐯",koala:"🐨",bear:"🐻",pig:"🐷",pig_nose:"🐽",cow:"🐮",boar:"🐗",monkey_face:"🐵",monkey:"🐒",horse:"🐴",sheep:"🐑",elephant:"🐘",panda_face:"🐼",penguin:"🐧",bird:"🐦",baby_chick:"🐤",hatched_chick:"🐥",hatching_chick:"🐣",chicken:"🐔",snake:"🐍",turtle:"🐢",bug:"🐛",bee:"🐝",ant:"🐜",beetle:"🐞",snail:"🐌",octopus:"🐙",shell:"🐚",tropical_fish:"🐠",fish:"🐟",dolphin:"🐬",whale:"🐳",racehorse:"🐎",dragon_face:"🐲",blowfish:"🐡",camel:"🐫",poodle:"🐩",feet:"🐾",bouquet:"💐",cherry_blossom:"🌸",tulip:"🌷",four_leaf_clover:"🍀",rose:"🌹",sunflower:"🌻",hibiscus:"🌺",maple_leaf:"🍁",leaves:"🍃",fallen_leaf:"🍂",herb:"🌿",ear_of_rice:"🌾",mushroom:"🍄",cactus:"🌵",palm_tree:"🌴",chestnut:"🌰",seedling:"🌱",blossom:"🌼",new_moon:"🌑",first_quarter_moon:"🌓",moon:"🌔",full_moon:"🌕",first_quarter_moon_with_face:"🌛",crescent_moon:"🌙",earth_asia:"🌏",volcano:"🌋",milky_way:"🌌",stars:"🌠",partly_sunny:"⛅",snowman:"⛄",cyclone:"🌀",foggy:"🌁",rainbow:"🌈",ocean:"🌊"},Objects:{bamboo:"🎍",gift_heart:"💝",dolls:"🎎",school_satchel:"🎒",mortar_board:"🎓",flags:"🎏",fireworks:"🎆",sparkler:"🎇",wind_chime:"🎐",rice_scene:"🎑",jack_o_lantern:"🎃",ghost:"👻",santa:"🎅",christmas_tree:"🎄",gift:"🎁",tanabata_tree:"🎋",tada:"🎉",confetti_ball:"🎊",balloon:"🎈",crossed_flags:"🎌",crystal_ball:"🔮",movie_camera:"🎥",camera:"📷",video_camera:"📹",vhs:"📼",cd:"💿",dvd:"📀",minidisc:"💽",floppy_disk:"💾",computer:"💻",iphone:"📱",telephone_receiver:"📞",pager:"📟",fax:"📠",satellite:"📡",tv:"📺",radio:"📻",loud_sound:"🔊",bell:"🔔",loudspeaker:"📢",mega:"📣",hourglass_flowing_sand:"⏳",hourglass:"⌛",alarm_clock:"⏰",watch:"⌚",unlock:"🔓",lock:"🔒",lock_with_ink_pen:"🔏",closed_lock_with_key:"🔐",key:"🔑",mag_right:"🔎",bulb:"💡",flashlight:"🔦",electric_plug:"🔌",battery:"🔋",mag:"🔍",bath:"🛀",toilet:"🚽",wrench:"🔧",nut_and_bolt:"🔩",hammer:"🔨",door:"🚪",smoking:"🚬",bomb:"💣",gun:"🔫",hocho:"🔪",pill:"💊",syringe:"💉",moneybag:"💰",yen:"💴",dollar:"💵",credit_card:"💳",money_with_wings:"💸",calling:"📲","e-mail":"📧",inbox_tray:"📥",outbox_tray:"📤",envelope_with_arrow:"📩",incoming_envelope:"📨",mailbox:"📫",mailbox_closed:"📪",postbox:"📮",package:"📦",memo:"📝",page_facing_up:"📄",page_with_curl:"📃",bookmark_tabs:"📑",bar_chart:"📊",chart_with_upwards_trend:"📈",chart_with_downwards_trend:"📉",scroll:"📜",clipboard:"📋",date:"📅",calendar:"📆",card_index:"📇",file_folder:"📁",open_file_folder:"📂",pushpin:"📌",paperclip:"📎",straight_ruler:"📏",triangular_ruler:"📐",closed_book:"📕",green_book:"📗",blue_book:"📘",orange_book:"📙",notebook:"📓",notebook_with_decorative_cover:"📔",ledger:"📒",books:"📚",book:"📖",bookmark:"🔖",name_badge:"📛",newspaper:"📰",art:"🎨",clapper:"🎬",microphone:"🎤",headphones:"🎧",musical_score:"🎼",musical_note:"🎵",notes:"🎶",musical_keyboard:"🎹",violin:"🎻",trumpet:"🎺",saxophone:"🎷",guitar:"🎸",space_invader:"👾",video_game:"🎮",black_joker:"🃏",flower_playing_cards:"🎴",mahjong:"🀄",game_die:"🎲",dart:"🎯",football:"🏈",basketball:"🏀",soccer:"⚽",baseball:"⚾",tennis:"🎾","8ball":"🎱",bowling:"🎳",golf:"⛳",checkered_flag:"🏁",trophy:"🏆",ski:"🎿",snowboarder:"🏂",swimmer:"🏊",surfer:"🏄",fishing_pole_and_fish:"🎣",tea:"🍵",sake:"🍶",beer:"🍺",beers:"🍻",cocktail:"🍸",tropical_drink:"🍹",wine_glass:"🍷",fork_and_knife:"🍴",pizza:"🍕",hamburger:"🍔",fries:"🍟",poultry_leg:"🍗",meat_on_bone:"🍖",spaghetti:"🍝",curry:"🍛",fried_shrimp:"🍤",bento:"🍱",sushi:"🍣",fish_cake:"🍥",rice_ball:"🍙",rice_cracker:"🍘",rice:"🍚",ramen:"🍜",stew:"🍲",oden:"🍢",dango:"🍡",egg:"🍳",bread:"🍞",doughnut:"🍩",custard:"🍮",icecream:"🍦",ice_cream:"🍨",shaved_ice:"🍧",birthday:"🎂",cake:"🍰",cookie:"🍪",chocolate_bar:"🍫",candy:"🍬",lollipop:"🍭",honey_pot:"🍯",apple:"🍎",green_apple:"🍏",tangerine:"🍊",cherries:"🍒",grapes:"🍇",watermelon:"🍉",strawberry:"🍓",peach:"🍑",melon:"🍈",banana:"🍌",pineapple:"🍍",sweet_potato:"🍠",eggplant:"🍆",tomato:"🍅",corn:"🌽"},Places:{house:"🏠",house_with_garden:"🏡",school:"🏫",office:"🏢",post_office:"🏣",hospital:"🏥",bank:"🏦",convenience_store:"🏪",love_hotel:"🏩",hotel:"🏨",wedding:"💒",church:"⛪",department_store:"🏬",city_sunrise:"🌇",city_sunset:"🌆",japanese_castle:"🏯",european_castle:"🏰",tent:"⛺",factory:"🏭",tokyo_tower:"🗼",japan:"🗾",mount_fuji:"🗻",sunrise_over_mountains:"🌄",sunrise:"🌅",night_with_stars:"🌃",statue_of_liberty:"🗽",bridge_at_night:"🌉",carousel_horse:"🎠",ferris_wheel:"🎡",fountain:"⛲",roller_coaster:"🎢",ship:"🚢",boat:"⛵",speedboat:"🚤",rocket:"🚀",seat:"💺",station:"🚉",bullettrain_side:"🚄",bullettrain_front:"🚅",metro:"🚇",railway_car:"🚃",bus:"🚌",blue_car:"🚙",car:"🚗",taxi:"🚕",truck:"🚚",rotating_light:"🚨",police_car:"🚓",fire_engine:"🚒",ambulance:"🚑",bike:"🚲",barber:"💈",busstop:"🚏",ticket:"🎫",traffic_light:"🚥",construction:"🚧",beginner:"🔰",fuelpump:"⛽",izakaya_lantern:"🏮",slot_machine:"🎰",moyai:"🗿",circus_tent:"🎪",performing_arts:"🎭",round_pushpin:"📍",triangular_flag_on_post:"🚩"},Symbols:{keycap_ten:"🔟",1234:"🔢",symbols:"🔣",capital_abcd:"🔠",abcd:"🔡",abc:"🔤",arrow_up_small:"🔼",arrow_down_small:"🔽",rewind:"⏪",fast_forward:"⏩",arrow_double_up:"⏫",arrow_double_down:"⏬",ok:"🆗",new:"🆕",up:"🆙",cool:"🆒",free:"🆓",ng:"🆖",signal_strength:"📶",cinema:"🎦",koko:"🈁",u6307:"🈯",u7a7a:"🈳",u6e80:"🈵",u5408:"🈴",u7981:"🈲",ideograph_advantage:"🉐",u5272:"🈹",u55b6:"🈺",u6709:"🈶",u7121:"🈚",restroom:"🚻",mens:"🚹",womens:"🚺",baby_symbol:"🚼",wc:"🚾",no_smoking:"🚭",u7533:"🈸",accept:"🉑",cl:"🆑",sos:"🆘",id:"🆔",no_entry_sign:"🚫",underage:"🔞",no_entry:"⛔",negative_squared_cross_mark:"❎",white_check_mark:"✅",heart_decoration:"💟",vs:"🆚",vibration_mode:"📳",mobile_phone_off:"📴",ab:"🆎",diamond_shape_with_a_dot_inside:"💠",ophiuchus:"⛎",six_pointed_star:"🔯",atm:"🏧",chart:"💹",heavy_dollar_sign:"💲",currency_exchange:"💱",x:"❌",exclamation:"❗",question:"❓",grey_exclamation:"❕",grey_question:"❔",o:"⭕",top:"🔝",end:"🔚",back:"🔙",on:"🔛",soon:"🔜",arrows_clockwise:"🔃",clock12:"🕛",clock1:"🕐",clock2:"🕑",clock3:"🕒",clock4:"🕓",clock5:"🕔",clock6:"🕕",clock7:"🕖",clock8:"🕗",clock9:"🕘",clock10:"🕙",clock11:"🕚",heavy_plus_sign:"➕",heavy_minus_sign:"➖",heavy_division_sign:"➗",white_flower:"💮",100:"💯",radio_button:"🔘",link:"🔗",curly_loop:"➰",trident:"🔱",small_red_triangle:"🔺",black_square_button:"🔲",white_square_button:"🔳",red_circle:"🔴",large_blue_circle:"🔵",small_red_triangle_down:"🔻",white_large_square:"⬜",black_large_square:"⬛",large_orange_diamond:"🔶",large_blue_diamond:"🔷",small_orange_diamond:"🔸",small_blue_diamond:"🔹"}}},function(y,i,r){Object.defineProperty(i,"__esModule",{value:!0}),i.EmojiPickerPlugin=i.EmojiPicker=void 0;var l=r(0),c=function(n){return n&&n.__esModule?n:{default:n}}(l),w={install:function(n){n.component("emoji-picker",c.default)}};typeof window<"u"&&(window.EmojiPicker=w),i.EmojiPicker=c.default,i.EmojiPickerPlugin=w,i.default=c.default},function(y,i){y.exports=function(r,l,c,w,n){var h,x=r=r||{},E=typeof r.default;E!=="object"&&E!=="function"||(h=r,x=r.default);var g=typeof x=="function"?x.options:x;l&&(g.render=l.render,g.staticRenderFns=l.staticRenderFns),w&&(g._scopeId=w);var _;if(n?(_=function(d){d=d||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,d||typeof __VUE_SSR_CONTEXT__>"u"||(d=__VUE_SSR_CONTEXT__),c&&c.call(this,d),d&&d._registeredComponents&&d._registeredComponents.add(n)},g._ssrRegister=_):c&&(_=c),_){var T=g.functional,o=T?g.render:g.beforeCreate;T?g.render=function(d,O){return _.call(O),o(d,O)}:g.beforeCreate=o?[].concat(o,_):[_]}return{esModule:h,exports:x,options:g}}},function(y,i){y.exports={render:function(){var r=this,l=r.$createElement,c=r._self._c||l;return c("div",[r._t("emoji-invoker",null,{events:{click:function(w){return r.toggle(w)}}}),r._v(" "),r.display.visible?c("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:r.hide,expression:"hide"}]},[r._t("emoji-picker",null,{emojis:r.emojis,insert:r.insert,display:r.display})],2):r._e()],2)},staticRenderFns:[]}}])})}(Q)),Q.exports}Ye();const Je={key:0,class:"loading-container"},Qe={key:1,class:"consultation-container"},We={class:"doctor-list-panel"},Ge=["onClick","onContextmenu"],Ze={class:"doctor-info"},et={class:"doctor-name"},tt={class:"last-message"},at={class:"chat-panel"},ot={key:0,class:"chat-header"},st={class:"chat-info"},nt={class:"department"},lt={key:0,class:"doctor-info-content"},rt={class:"doctor-profile"},it={class:"doctor-basic-info"},ut={class:"doctor-details-info"},ct={class:"info-item"},_t={class:"value"},dt={class:"info-item"},pt={class:"value"},ft={class:"info-item"},mt={class:"value"},vt={class:"info-item"},ht={class:"value"},gt={class:"dialog-footer"},bt={key:0,class:"empty-chat"},kt={key:1},yt={class:"message-content"},wt=["innerHTML"],xt={key:1,class:"message-image"},Ct={class:"message-time"},jt={key:1,class:"input-container"},Mt={class:"input-actions"},Et={class:"left-buttons"},zt={key:0,class:"emoji-picker"},Dt=["onClick"],Pt={class:"doctor-selection"},Vt={class:"doctor-list"},qt=["onClick"],$t={class:"doctor-details"},Lt={__name:"Chat",setup(te){const L=b(!1),y=b(["😊","😂","😍","😢","😎","😡","👍","👎","❤️","🎉","🔥","💯","👏","🙌","🙏"]),i=()=>{L.value=!L.value},r=t=>{P.value+=t,L.value=!1},l=b(!1),c=()=>{o.value&&(l.value=!0)},w=()=>{l.value=!1},n=()=>{l.value=!1,re(()=>{const t=document.querySelector(".input-container textarea");t&&t.focus()})},h={resident:"住院医师",attending:"主治医师",associate_chief:"副主任医师",chief:"主任医师"},x=Te,E=Be,g=b(!0),_=b([]),{runAsync:T}=J(()=>N.get("/api/chat/user_list"),{manual:!0}),o=b(null),d=b({}),O=ee(()=>o.value?d.value[o.value.id]||[]:[]),P=b(""),j=b(null),S=b(!1),I=b(""),{runAsync:de}=J(()=>N.get("/api/patient/doctorlist"),{manual:!0}),A=b(!1),B=Le({x:0,y:0}),ae=b(null),pe=(t,e)=>{B.x=t.clientX,B.y=t.clientY,ae.value=e,A.value=!0},{runAsync:fe}=J(t=>N.delete(`/api/chat/${t}`),{manual:!0}),me=t=>{t&&(_.value=_.value.filter(e=>e.id!==t.id),fe(t.id).then(()=>{}).catch(e=>{D.error(`删除医生 ${t.name} 失败`)}),A.value=!1,D.success(`医生 ${t.name} 已删除`))};window.addEventListener("click",()=>{A.value=!1});const W=b([]),ve=ee(()=>{if(!I.value)return W.value;const t=I.value.toLowerCase();return W.value.filter(e=>e.name.toLowerCase().includes(t)||e.department.toLowerCase().includes(t))}),F=b(null),he=t=>He(t).format("HH:mm"),ge=t=>{const e=d.value[t];if(!e||e.length===0)return"暂无消息";const m=e[e.length-1];return m.type==="image"?"[图片]":m.content.length>12?m.content.substring(0,12)+"...":m.content},be=(t,e)=>(e===0||O.value[e-1],!0),V=ee(()=>"patient_"+x.value),ke=()=>{j.value=Xe("ws://localhost:5000"),j.value.on("connect",()=>{}),j.value.on("newMessage",t=>{if(d.value[t.from_user]||(d.value[t.from_user]=[]),d.value[t.from_user].push({...t,read:t.from_user==="doctor_"+o.value.id?1:0}),Z(o.value.id),t.from_user!==V.value){const e=_.value.find(m=>"doctor_"+m.id===t.from_user);e&&e.id!==o.value.id&&(e.unreadCount=(e.unreadCount||0)+1)}T().then(e=>{_.value=e.data.data||[]}).catch(e=>{}),R()})},R=()=>{re(()=>{F.value&&(F.value.scrollTop=F.value.scrollHeight)})},G=t=>{o.value=t,t.unreadCount>0&&(t.unreadCount=0),Z(t.id),R()},{runAsync:ye}=J((t,e)=>N.get("/api/chat/message",{params:{from_user:t,to_user:e}}),{manual:!0}),Z=async t=>{const m=(await ye("doctor_"+t,V.value)).data.data||[];d.value[t]=m,R()},oe=()=>{if(!P.value.trim()||!o.value)return;const t={from_user:V.value,from_user_avatar:E.value,to_user:"doctor_"+o.value.id,to_user_avatar:o.value.avatar_url,content:P.value.trim(),type:"text"};j.value&&j.value.emit("sendMessage",t),d.value[o.value.id]||(d.value[o.value.id]=[]),d.value[o.value.id].push(t),P.value="",R()},we=t=>{const e=t.type.startsWith("image/"),m=t.size/1024/1024<5;return e?m?!0:(D.error("上传的图片大小不能超过 5MB"),!1):(D.error("只能上传图片格式的文件"),!1)},xe=t=>{t.code===1?(je(t.data.file_url),D.success("图片上传成功")):D.error(t.msg||"图片上传失败")},Ce=t=>{D.error("图片上传失败，请重试")},je=t=>{if(!o.value)return;const e={from_user:V.value,from_user_avatar:E.value,to_user:"doctor_"+o.value.id,to_user_avatar:o.value.avatar_url,content:t,type:"image"};j.value&&j.value.emit("sendMessage",e),d.value[o.value.id]||(d.value[o.value.id]=[]),d.value[o.value.id].push(e),R()},Me=()=>{de().then(t=>{W.value=t.data.data||[]}).catch(t=>{}),S.value=!0,I.value=""},Ee=t=>{const e=_.value.find(M=>M.id===t.id);if(e){o.value=e,S.value=!1;return}const m={...t,unreadCount:0};N.post(`/api/chat/${t.id}`).then(M=>{D.success("新问诊创建成功")}).catch(M=>{}),_.value.unshift(m),o.value=m,S.value=!1,d.value[t.id]=[]};return Oe(async()=>{try{const t=await T();_.value=t.data.data||[];for(const e of _.value)await Z(e.id);_.value.length>0&&G(_.value[0]),ke(),_.value.length>0&&G(_.value[0]),g.value=!1}catch{g.value=!1}}),Se(()=>{j.value&&j.value.disconnect()}),(t,e)=>{const m=C("el-icon"),M=C("el-avatar"),ze=C("el-badge"),De=C("el-divider"),H=C("el-col"),Pe=C("el-row"),U=C("el-button"),se=C("el-dialog"),Ve=C("el-image"),ne=C("el-input"),qe=C("el-upload");return g.value?(p(),v("div",Je,[u(m,{class:"loading-icon",size:40},{default:f(()=>[u($(Ue))]),_:1}),e[5]||(e[5]=a("p",null,"正在加载...",-1))])):(p(),v("div",Qe,[a("div",We,[e[6]||(e[6]=a("div",{class:"doctor-list-header"},[a("h3",null,"医生列表")],-1)),a("div",{class:"add-doctor",onClick:Me},[u(m,{size:32},{default:f(()=>[u($(ie))]),_:1})]),(p(!0),v(X,null,K(_.value,s=>{var q;return p(),v("div",{key:s.id,class:ue(["doctor-item",{active:((q=o.value)==null?void 0:q.id)===s.id}]),onClick:le=>G(s),onContextmenu:Ne(le=>pe(le,s),["prevent"])},[u(ze,{value:s.unreadCount,max:99,hidden:s.unreadCount===0},{default:f(()=>[u(M,{size:48,src:s.avatar_url},null,8,["src"])]),_:2},1032,["value","hidden"]),a("div",Ze,[a("div",et,k(s.name),1),a("div",tt,k(ge(s.id)),1)])],42,Ge)}),128)),A.value?(p(),v("div",{key:0,class:"context-menu",style:Ie({top:B.y+"px",left:B.x+"px"})},[a("ul",null,[a("li",{onClick:e[0]||(e[0]=s=>me(ae.value))},"删除医生")])],4)):z("",!0)]),a("div",at,[o.value?(p(),v("div",ot,[u(M,{size:40,src:o.value.avatar_url,onClick:c,class:"doctor-avatar-clickable"},null,8,["src"]),a("div",st,[a("h3",null,k(o.value.name)+" 医生",1),a("p",nt,k(o.value.department)+" | "+k(h[o.value.position_rank]||"未知职称"),1)])])):z("",!0),u(se,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),title:"医生信息",width:"500px","before-close":w},{footer:f(()=>[a("span",gt,[u(U,{onClick:w},{default:f(()=>e[11]||(e[11]=[Y("关闭")])),_:1,__:[11]}),u(U,{type:"primary",onClick:n},{default:f(()=>e[12]||(e[12]=[Y("开始问诊")])),_:1,__:[12]})])]),default:f(()=>[o.value?(p(),v("div",lt,[a("div",rt,[u(M,{size:80,src:o.value.avatar_url},null,8,["src"]),a("div",it,[a("h2",null,k(o.value.name),1)])]),u(De),a("div",ut,[u(Pe,{gutter:20},{default:f(()=>[u(H,{span:12},{default:f(()=>[a("div",ct,[e[7]||(e[7]=a("span",{class:"label"},"医院：",-1)),a("span",_t,k(o.value.hospital||"暂无"),1)])]),_:1}),u(H,{span:12},{default:f(()=>[a("div",dt,[e[8]||(e[8]=a("span",{class:"label"},"科室：",-1)),a("span",pt,k(o.value.department||"暂无"),1)])]),_:1}),u(H,{span:12},{default:f(()=>[a("div",ft,[e[9]||(e[9]=a("span",{class:"label"},"职称：",-1)),a("span",mt,k(h[o.value.position_rank]||"未知职称"),1)])]),_:1}),u(H,{span:12},{default:f(()=>[a("div",vt,[e[10]||(e[10]=a("span",{class:"label"},"擅长领域：",-1)),a("span",ht,k(o.value.specialty||"暂无"),1)])]),_:1})]),_:1})])])):z("",!0)]),_:1},8,["modelValue"]),a("div",{ref_key:"messagesContainer",ref:F,class:"messages-container"},[o.value?(p(),v("div",kt,[(p(!0),v(X,null,K(O.value,(s,q)=>(p(),v("div",{key:q,class:ue(["message-item",s.from_user===V.value?"sent":"received"])},[be(s,q)?(p(),ce(M,{key:0,size:36,src:s.from_user===V.value?$(E):o.value.avatar_url,class:"message-avatar"},null,8,["src"])):z("",!0),a("div",yt,[s.type==="text"?(p(),v("div",{key:0,class:"message-text",innerHTML:s.content},null,8,wt)):s.type==="image"?(p(),v("div",xt,[u(Ve,{src:s.content,"preview-src-list":[s.content],fit:"cover",style:{"max-width":"200px","max-height":"200px","border-radius":"8px"}},null,8,["src","preview-src-list"])])):z("",!0),a("div",Ct,k(he(s.time)),1),s.from_user!==V.value&&!s.read?(p(),ce(m,{key:2,class:"read-status"},{default:f(()=>[u($(Fe))]),_:1})):z("",!0)])],2))),128))])):(p(),v("div",bt,[u(m,null,{default:f(()=>[u($(Ae))]),_:1}),e[13]||(e[13]=a("p",null,"请选择医生开始问诊",-1))]))],512),o.value?(p(),v("div",jt,[u(ne,{modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=s=>P.value=s),placeholder:"输入您的问题...",type:"textarea",rows:2,resize:"none",onKeyup:Re(oe,["enter"])},null,8,["modelValue"]),a("div",Mt,[a("div",Et,[u(qe,{class:"image-uploader",action:"/api/upload/picture","show-file-list":!1,"before-upload":we,"on-success":xe,"on-error":Ce},{default:f(()=>[u(U,null,{default:f(()=>[u(m,null,{default:f(()=>[u($(ie))]),_:1})]),_:1})]),_:1}),u(U,{onClick:i},{default:f(()=>e[14]||(e[14]=[Y(" 😊 ")])),_:1,__:[14]})]),u(U,{type:"primary",onClick:oe,disabled:!P.value.trim()},{default:f(()=>e[15]||(e[15]=[Y(" 发送 ")])),_:1,__:[15]},8,["disabled"]),L.value?(p(),v("div",zt,[(p(!0),v(X,null,K(y.value,s=>(p(),v("span",{key:s,class:"emoji-item",onClick:q=>r(s)},k(s),9,Dt))),128))])):z("",!0)])])):z("",!0)]),u(se,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=s=>S.value=s),title:"选择问诊医生",width:"600px"},{default:f(()=>[a("div",Pt,[u(ne,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=s=>I.value=s),placeholder:"搜索医生姓名或科室",clearable:"",class:"search-input"},null,8,["modelValue"]),a("div",Vt,[(p(!0),v(X,null,K(ve.value,s=>(p(),v("div",{key:s.id,class:"doctor-card",onClick:q=>Ee(s)},[u(M,{size:60,src:s.avatar_url},null,8,["src"]),a("div",$t,[a("h4",null,k(s.name),1),a("p",null,k(h[s.position_rank])+" | "+k(s.department),1)])],8,qt))),128))])])]),_:1},8,["modelValue"])]))}}},Rt=$e(Lt,[["__scopeId","data-v-433c3149"]]);export{Rt as default};
