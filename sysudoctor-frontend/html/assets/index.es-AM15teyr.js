import{X as te,S as j,r as C,Y as K,c as x,Z as Y,W as $,$ as re}from"./index-CNVEcACA.js";const oe={},ae=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),se=()=>oe,H=e=>Array.isArray(e),X=e=>e!==null&&typeof e=="object",Z=e=>e instanceof Function,B=e=>e==null,z=typeof window>"u",J=()=>{var e;return z||B((e=window.document)==null?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ue=()=>{var t;var e;return(e=!z&&((t=window.navigator)==null?void 0:t.onLine))!==null&&e!==void 0?e:!0},V=()=>new Promise(()=>{}),I=e=>re(e)?e.value:e,ce=e=>X(e)?Object.assign(H(e)?[]:{},e):e,M=new Map,ie=e=>B(e)?void 0:M.get(e),le=(e,t,n)=>{const o=M.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const a=setTimeout(()=>M.delete(e),t);M.set(e,{...n,timer:a})},N=e=>e;function k(e,t,n){let o,a,i,c,r,s,u=0,h=!1,d=!1,T=!0;const f=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,X(n)&&(h=!!n.leading,d="maxWait"in n,i=d?Math.max(+n.maxWait||0,t):i,T="trailing"in n?!!n.trailing:T);function R(l){const P=o,y=a;return o=a=void 0,u=l,c=e.apply(y,P),c}function m(l,P){return f?(window.cancelAnimationFrame(r),window.requestAnimationFrame(l)):setTimeout(l,P)}function w(l){if(f)return window.cancelAnimationFrame(l);clearTimeout(l)}function v(l){return u=l,r=m(E,t),h?R(l):c}function p(l){const P=l-s,y=l-u,D=t-P;return d?Math.min(D,i-y):D}function g(l){const P=l-s,y=l-u;return s===void 0||P>=t||P<0||d&&y>=i}function E(){const l=Date.now();if(g(l))return b(l);r=m(E,p(l))}function b(l){return r=void 0,T&&o?R(l):(o=a=void 0,c)}function O(){r!==void 0&&w(r),u=0,o=s=a=r=void 0}function L(){return r===void 0?c:b(Date.now())}function S(){return r!==void 0}function A(){const l=Date.now(),P=g(l);for(var y=arguments.length,D=new Array(y),W=0;W<y;W++)D[W]=arguments[W];if(o=D,a=this,s=l,P){if(r===void 0)return v(s);if(d)return r=m(E,t),R(s)}return r===void 0&&(r=m(E,t)),c}return A.cancel=O,A.flush=L,A.pending=S,A}function fe(e,t,n){let o=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return X(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),k(e,t,{leading:o,trailing:a,maxWait:t})}var de=N((e,t)=>{let{debounceInterval:n,debounceOptions:o,manual:a}=t;const i=C(!1),c=C(),r=x(()=>o),s=x(()=>I(n)),u=C(e.context.runAsync);return a||(i.value=!0),Y(h=>{B(s.value)||(c.value=k(d=>d(),s.value,r.value),e.context.runAsync=function(){for(var d=arguments.length,T=new Array(d),f=0;f<d;f++)T[f]=arguments[f];return new Promise((R,m)=>{i.value?(i.value=!1,u.value(...T).then(R).catch(m)):c.value(()=>{u.value(...T).then(R).catch(m)})})},h(()=>{var d;(d=c.value)==null||d.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var h;(h=c.value)==null||h.cancel()}}}),me=N((e,t)=>{let{errorRetryCount:n=0,errorRetryInterval:o=0}=t;const a=C(),i=C(0),c=x(()=>I(n)),r=x(()=>I(o));let s=!1;const u=()=>{i.value=0},h=x(()=>{if(r.value)return r.value;const f=1e3,w=Math.floor(Math.random()*2**Math.min(i.value,9)+1);return f*w}),d=()=>{let f;const R=c.value===-1,m=i.value<c.value;return(R||m)&&(R||(i.value+=1),f=setTimeout(()=>{s=!0,e.context.refresh()},h.value)),()=>f&&clearTimeout(f)},T=()=>{a.value&&a.value()};return{onBefore(){s||u(),s=!1,T()},onSuccess(){u()},onError(){a.value=d()},onCancel(){u(),T()}}}),ve=N((e,t)=>{let{ready:n=C(!0),manual:o,defaultParams:a=[]}=t;return $(n,i=>{!o&&i&&e.context.run(...a)},{flush:"sync"}),{onBefore(){if(!(Z(n)?n():n.value))return e.loading.value=!1,{isBreak:!0}}}}),ge=N((e,t)=>{let{refreshDeps:n,refreshDepsAction:o,manual:a}=t;if(n===void 0||H(n)&&n.length===0)return{};const i=H(n)?n:[n];return $(i,()=>{o?o():!a&&e.context.refresh()}),{}}),he=N((e,t)=>{let{throttleInterval:n,throttleOptions:o}=t;const a=C(),i=x(()=>I(n)),c=x(()=>o),r=C(e.context.runAsync);return Y(s=>{if(B(n))return{};a.value=fe(u=>u(),i.value,c.value),e.context.runAsync=function(){for(var u=arguments.length,h=new Array(u),d=0;d<u;d++)h[d]=arguments[d];return new Promise((T,f)=>{a.value(()=>{r.value(...h).then(T).catch(f)})})},s(()=>{var u;(u=a.value)==null||u.cancel(),e.context.runAsync=r.value})}),{onCancel(){var s;(s=a.value)==null||s.cancel()}}});const pe=(e,t)=>n=>{Object.keys(n).forEach(o=>{e[o].value=n[o]}),t.forEach(o=>o(e))},Re=(e,t)=>()=>{let n=t;for(let o=e.length;o-- >0;)n=e[o](n);return n()},Ee=(e,t,n)=>{var o,a;const{initialData:i,onSuccess:c,onError:r,onBefore:s,onAfter:u}=t,h=C((o=n==null?void 0:n.loading)!==null&&o!==void 0?o:!1),d=K((a=n==null?void 0:n.data)!==null&&a!==void 0?a:i),T=K(n==null?void 0:n.error),f=C(n==null?void 0:n.params),R=C([]),m=K("pending"),w={},v=pe({status:m,loading:h,data:d,error:T,params:f},[]),p=function(E){for(var b=arguments.length,O=new Array(b>1?b-1:0),L=1;L<b;L++)O[L-1]=arguments[L];if(E==="onQuery"){const S=R.value.map(A=>A.onQuery).filter(Boolean);return{servicePromise:Re(S,O[0])()}}else{const S=R.value.map(A=>{var l;return(l=A[E])==null?void 0:l.call(A,...O)});return Object.assign({},...S)}},g=C(0);return w.runAsync=async function(){for(var E=arguments.length,b=new Array(E),O=0;O<E;O++)b[O]=arguments[O];v({loading:!0,params:b,status:"pending"}),g.value+=1;const L=g.value,{isBreak:S,breakResult:A=V()}=p("onBefore",b);if(S)return v({status:"settled"}),A;s==null||s(b);try{const l=()=>new Promise(D=>D(e(...f.value)));let{servicePromise:P}=p("onQuery",l);P||(P=l());const y=await P;return L!==g.value?V():(v({data:y,loading:!1,error:void 0,status:"settled"}),p("onSuccess",y,b),c==null||c(y,b),L===g.value&&p("onAfter",b,y,void 0),u==null||u(b),y)}catch(l){if(L!==g.value)return V();throw v({loading:!1,error:l,status:"settled"}),p("onError",l,b),r==null||r(l,b),L===g.value&&p("onAfter",b,void 0,l),u==null||u(b),l}},w.run=function(){w.runAsync(...arguments).catch(E=>{r||console.error(E)})},w.cancel=()=>{g.value+=1,v({loading:!1}),p("onCancel")},w.refresh=()=>{w.run(...f.value||[])},w.refreshAsync=()=>w.runAsync(...f.value||[]),w.mutate=E=>{const b=Z(E)?E(d.value):E,O=ce(b);v({data:O}),p("onMutate",O)},{status:m,loading:h,data:d,error:T,params:f,plugins:R,context:w}};function we(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const o=te(ae,{}),a={...se(),...o,...t},{manual:i=!1,defaultParams:c=[]}=a,r=Ee(e,a);if(r.plugins.value=n.map(s=>s(r,a)),!i){const s=r.params.value||c;r.context.run(...s)}return j(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const Q=new Map,Te=(e,t)=>{Q.set(e,t),t.then(n=>(Q.delete(e),n)).catch(()=>{Q.delete(e)})},be=e=>Q.get(e),F=new Map,Ce=(e,t)=>{F.has(e)&&F.get(e).forEach(n=>n(t))},Pe=(e,t)=>(F.has(e)?F.get(e).push(t):F.set(e,[t]),()=>{const n=F.get(e).indexOf(t);F.get(e).splice(n,1)});var ye=N((e,t)=>{let{cacheKey:n,cacheTime:o=6e5,staleTime:a=0,getCache:i,setCache:c}=t;if(!n)return{};const r=Z(n)?n:()=>n,s=C(()=>{});let u;const h=v=>i?i(v):ie(v),d=(v,p,g)=>{c?c(v,g):le(v,p,g),Ce(v,g.data)},T=v=>a===-1||v+a>new Date().getTime(),f=(v,p)=>Object.prototype.hasOwnProperty.call(v,p),R=v=>{const p=r(v);return Pe(p,g=>{e.data.value=g})},m=r(),w=h(m);return w&&f(w,"data")&&(e.data.value=w.data,e.params.value=w.params),m&&(s.value=R()),j(()=>{s.value()}),{onBefore(v){const p=r(v),g=h(p);if(!g||!f(g,"data"))return{};if(T(g.time))return e.data.value=g.data,e.loading.value=!1,{isBreak:!0,breakResult:g.data};e.data.value=g.data},onQuery(v){const p=e.params.value,g=r(p);let E=be(g);return E&&E!==u?()=>E:(E=v(),u=E,Te(g,E),()=>E)},onSuccess(v,p){const g=r(p);g&&(s.value(),d(g,o,{data:v,params:p,time:new Date().getTime()}),s.value=R(p))},onMutate(v){const p=r(e.params.value);p&&(s.value(),d(p,o,{data:v,params:e.params.value,time:new Date().getTime()}),s.value=R(e.params.value))}}});function Oe(e){let t,n;class o extends Promise{constructor(i){super(i),this.cancel=()=>{n(),clearTimeout(t)}}}return new o(a=>{n=a,t=setTimeout(n,e)})}function G(){return new Date().getTime()}var xe=N((e,t)=>{let{loadingDelay:n=0,loadingKeep:o=0}=t;const a=C(()=>{}),i=x(()=>I(n)),c=x(()=>I(o));let r=0,s={};const u=()=>{let h;return i.value&&(h=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},i.value)),()=>h&&clearTimeout(h)};return{onBefore(){e.loading.value=!i.value,a.value(),a.value=u(),r=G()},onQuery(h){if(!c.value)return()=>h();s=Oe(c.value+i.value);const d=async()=>{try{const f=await h();return G()-r<=i.value&&s.cancel(),Promise.resolve(f)}catch(f){return G()-r<=i.value&&s.cancel(),Promise.reject(f)}},T=Promise.allSettled([d(),s]).then(f=>{const R=f[0];return R.status==="fulfilled"?R.value:Promise.reject(R.reason)});return()=>T},onCancel(){a.value()},onAfter(){a.value()}}});const q=new Set,ee=new Set,ne=new Set,_=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=q;break;case"RECONNECT_LISTENER":n=ne;break;case"VISIBLE_LISTENER":n=ee;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},U=e=>{e.forEach(t=>{t()})};!z&&(window!=null&&window.addEventListener)&&(window.addEventListener("visibilitychange",()=>{J()&&U(ee)},!1),window.addEventListener("focus",()=>U(q),!1),window.addEventListener("online",()=>U(ne),!1));var Ae=N((e,t)=>{let{pollingInterval:n,pollingWhenHidden:o=!1,pollingWhenOffline:a=!1,errorRetryCount:i=0}=t;const c=C(),r=C(!1),s=x(()=>I(n)),u=x(()=>I(i)),h=[],d=m=>{m&&h.push(m)},T=()=>(o||J())&&(a||ue()),f=m=>{if(e.error.value&&u.value!==0)return;let w;if(!B(s.value)&&s.value>=0)if(T())w=setTimeout(m,s.value);else{r.value=!0;return}return()=>w&&clearTimeout(w)},R=()=>{r.value&&T()&&(e.context.refresh(),r.value=!1)};return $(s,()=>{c.value&&(c.value(),c.value=f(()=>e.context.refresh()))}),o||d(_("VISIBLE_LISTENER",R)),a||d(_("RECONNECT_LISTENER",R)),j(()=>{h.forEach(m=>m())}),{onBefore(){var m;(m=c.value)==null||m.call(c)},onCancel(){var m;(m=c.value)==null||m.call(c)},onAfter(){c.value=f(()=>e.context.refresh())}}});const Le=(e,t)=>{let n=!1;return function(){n||(n=!0,e(...arguments),setTimeout(()=>{n=!1},t))}};var Ie=N((e,t)=>{let{refreshOnWindowFocus:n=!1,refocusTimespan:o=5e3}=t;const a=x(()=>I(n)),i=x(()=>I(o)),c=[],r=u=>{u&&c.push(u)},s=()=>{c.forEach(u=>u())};return Y(()=>{if(s(),a.value){const u=Le(e.context.refresh,i.value);r(_("VISIBLE_LISTENER",u)),r(_("FOCUS_LISTENER",u))}}),j(()=>{s()}),{}});function Se(e,t){return we(e,t,[xe,me,de,Ae,he,Ie,ge,ve,ye])}export{Se as u};
