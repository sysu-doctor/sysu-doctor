import{d as le,r as g,b as te,U as oe,c as M,o as ne,W as se,j as _,i as v,h as a,w as t,f as u,p as d,l as de,v as ue,t as m,F as h,y as w,e as R,a as re,E as b,u as ie,g as r,V as me,_ as _e}from"./index-CNVEcACA.js";import{_ as C}from"./request-CwFpdHqZ.js";import{u as Y}from"./index.es-AM15teyr.js";const pe={class:"doctor-info-container"},fe={class:"header"},ve={key:0,class:"loading-container"},ce={key:1,class:"content"},ge={key:0},be={key:1},ye={class:"footer"},Ve=["src"],ke={key:1,class:"el-icon-plus avatar-uploader-icon"},he="/public/vite.svg",we=le({__name:"DoctorInfo",setup(Ue){const U=g(!0),A=g([{id:1,name:"中山大学附属第一医院"},{id:2,name:"中山大学孙逸仙纪念医院"},{id:3,name:"北京协和医院"}]),V=g([{id:1,name:"心血管内科"},{id:2,name:"神经外科"},{id:3,name:"消化内科"},{id:4,name:"呼吸内科"},{id:5,name:"骨科"},{id:6,name:"儿科"},{id:7,name:"妇产科"},{id:8,name:"眼科"},{id:9,name:"耳鼻喉科"},{id:10,name:"皮肤科"},{id:11,name:"内分泌科"},{id:12,name:"肾内科"},{id:13,name:"血液科"},{id:14,name:"风湿免疫科"},{id:15,name:"急诊科"}]),z=ie(),F={monday:"周一",tuesday:"周二",wednesday:"周三",thursday:"周四",friday:"周五"},B=["monday","tuesday","wednesday","thursday","friday"],s=g({phone:oe.value,name:te.value,gender:"",birth_date:"",hospital_id:0,department_id:0,internal_id:"",position_rank:"",specialty:"",schedule:{monday:{morning:!1,afternoon:!1},tuesday:{morning:!1,afternoon:!1},wednesday:{morning:!1,afternoon:!1},thursday:{morning:!1,afternoon:!1},friday:{morning:!1,afternoon:!1}},avatar_url:""}),L=M(()=>{const n=A.value.find(e=>e.id===s.value.hospital_id);return n?n.name:""}),S=M(()=>{const n=V.value.find(e=>e.id===s.value.department_id);return n?n.name:""}),P={resident:"住院医师",attending:"主治医师",associate_chief:"副主任医师",chief:"主任医师"},W=M(()=>P[s.value.position_rank]||"未填写"),$=()=>{z.push(me.value||"/")},{runAsync:j}=Y(()=>C.get("/api/doctor/"),{manual:!0}),{runAsync:N}=Y(n=>C.get(`/api/doctor/departments/${n}`),{manual:!0});ne(async()=>{try{const n=await j();s.value=n.data.data,s.value.schedule===null&&(s.value.schedule={monday:{morning:!1,afternoon:!1},tuesday:{morning:!1,afternoon:!1},wednesday:{morning:!1,afternoon:!1},thursday:{morning:!1,afternoon:!1},friday:{morning:!1,afternoon:!1}}),U.value=!1}catch{U.value=!1}});const y=g(!1),o=g({...s.value,position_rank:s.value.position_rank||"resident"}),q=async()=>{if(o.value={...s.value},o.value.hospital_id){const n=await N(o.value.hospital_id);V.value=n.data.data}y.value=!0};se(()=>o.value.hospital_id,async n=>{if(n)try{const e=await N(n);V.value=e.data.data}catch{}});const T=async()=>{var n;try{await C.put("/api/doctor/doctor_manage",o.value),s.value={...o.value},re.value=o.value.avatar_url,y.value=!1,b.success("修改信息成功")}catch(e){const f=((n=e==null?void 0:e.data)==null?void 0:n.msg)||"修改信息失败";b.error(f)}},G=n=>{n.code===1?(o.value.avatar_url=n.data.file_url,b.success("头像上传成功")):b.error(n.msg||"头像上传失败")},J=n=>{const e=n.type.startsWith("image/"),f=n.size/1024/1024<2;return e||b.error("上传的文件必须是图片格式"),f||b.error("上传的图片大小不能超过 2MB"),e&&f};return(n,e)=>{const f=u("el-button"),K=u("el-icon"),O=u("el-avatar"),p=u("el-descriptions-item"),Q=u("el-descriptions"),X=u("el-upload"),i=u("el-form-item"),k=u("el-input"),E=u("el-radio"),Z=u("el-radio-group"),H=u("el-date-picker"),c=u("el-option"),D=u("el-select"),I=u("el-checkbox"),ee=u("el-form"),ae=u("el-dialog");return r(),_("div",pe,[v("div",fe,[a(f,{type:"text",onClick:$,class:"back-button"},{default:t(()=>e[11]||(e[11]=[v("i",{class:"el-icon-arrow-left"},null,-1),d(" 返回主页 ")])),_:1,__:[11]}),e[12]||(e[12]=v("h2",{class:"title"},"医生个人信息",-1))]),U.value?(r(),_("div",ve,[a(K,{class:"loading-icon",size:40},{default:t(()=>[a(de(ue))]),_:1}),e[13]||(e[13]=v("p",null,"正在加载...",-1))])):(r(),_("div",ce,[a(O,{src:s.value.avatar_url||he,class:"avatar"},null,8,["src"]),a(Q,{border:"",column:"2",class:"descriptions"},{default:t(()=>[a(p,{label:"姓名"},{default:t(()=>[d(m(s.value.name),1)]),_:1}),a(p,{label:"电话"},{default:t(()=>[d(m(s.value.phone),1)]),_:1}),a(p,{label:"性别"},{default:t(()=>[d(m(s.value.gender==="male"?"男":s.value.gender==="female"?"女":"未填写"),1)]),_:1}),a(p,{label:"出生日期"},{default:t(()=>[d(m(s.value.birth_date?new Date(s.value.birth_date).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未填写"),1)]),_:1}),a(p,{label:"医院"},{default:t(()=>[d(m(L.value||"未填写"),1)]),_:1}),a(p,{label:"科室"},{default:t(()=>[d(m(S.value||"未填写"),1)]),_:1}),a(p,{label:"院内工号"},{default:t(()=>[d(m(s.value.internal_id||"未填写"),1)]),_:1}),a(p,{label:"职称等级"},{default:t(()=>[d(m(W.value),1)]),_:1}),a(p,{label:"擅长方向"},{default:t(()=>[d(m(s.value.specialty||"未填写"),1)]),_:1}),a(p,{label:"出诊时间"},{default:t(()=>[(r(),_(h,null,w(B,l=>v("div",{key:l},[s.value.schedule[l].morning||s.value.schedule[l].afternoon?(r(),_("span",ge,m(s.value.schedule[l].morning?"上午":"")+" "+m(s.value.schedule[l].afternoon?"下午":""),1)):(r(),_("span",be,"未排班"))])),64))]),_:1})]),_:1})])),v("div",ye,[a(f,{type:"primary",onClick:q},{default:t(()=>e[14]||(e[14]=[d("修改信息")])),_:1,__:[14]})]),a(ae,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),title:"修改医生信息",width:"600px"},{default:t(()=>[a(i,{label:"头像"},{default:t(()=>[a(X,{class:"avatar-uploader",action:"/api/upload/picture","show-file-list":!1,"on-success":G,"before-upload":J},{default:t(()=>[o.value.avatar_url?(r(),_("img",{key:0,src:o.value.avatar_url,class:"avatar"},null,8,Ve)):(r(),_("i",ke))]),_:1})]),_:1}),a(ee,{model:o.value,"label-width":"120px"},{default:t(()=>[a(i,{label:"姓名"},{default:t(()=>[a(k,{modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.name=l),readonly:""},null,8,["modelValue"])]),_:1}),a(i,{label:"电话"},{default:t(()=>[a(k,{modelValue:o.value.phone,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.phone=l),readonly:""},null,8,["modelValue"])]),_:1}),a(i,{label:"性别"},{default:t(()=>[a(Z,{modelValue:o.value.gender,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.gender=l)},{default:t(()=>[a(E,{label:"male"},{default:t(()=>e[15]||(e[15]=[d("男")])),_:1,__:[15]}),a(E,{label:"female"},{default:t(()=>e[16]||(e[16]=[d("女")])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"出生日期"},{default:t(()=>[a(H,{modelValue:o.value.birth_date,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.birth_date=l),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(i,{label:"医院"},{default:t(()=>[a(D,{modelValue:o.value.hospital_id,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.hospital_id=l),placeholder:"请选择医院"},{default:t(()=>[(r(!0),_(h,null,w(A.value,l=>(r(),R(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"科室"},{default:t(()=>[a(D,{modelValue:o.value.department_id,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.department_id=l),placeholder:"请选择科室"},{default:t(()=>[(r(!0),_(h,null,w(V.value,l=>(r(),R(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"院内工号"},{default:t(()=>[a(k,{modelValue:o.value.internal_id,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.internal_id=l)},null,8,["modelValue"])]),_:1}),a(i,{label:"职称等级"},{default:t(()=>[a(D,{modelValue:o.value.position_rank,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.position_rank=l),placeholder:"请选择职称等级"},{default:t(()=>[a(c,{label:"住院医师",value:"resident"}),a(c,{label:"主治医师",value:"attending"}),a(c,{label:"副主任医师",value:"associate_chief"}),a(c,{label:"主任医师",value:"chief"})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"擅长方向"},{default:t(()=>[a(k,{modelValue:o.value.specialty,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.specialty=l)},null,8,["modelValue"])]),_:1}),a(i,{label:"出诊时间"},{default:t(()=>[(r(),_(h,null,w(B,l=>v("div",{key:l,class:"schedule-item"},[v("span",null,m(F[l]),1),a(I,{modelValue:o.value.schedule[l].morning,"onUpdate:modelValue":x=>o.value.schedule[l].morning=x},{default:t(()=>e[17]||(e[17]=[d("上午")])),_:2,__:[17]},1032,["modelValue","onUpdate:modelValue"]),a(I,{modelValue:o.value.schedule[l].afternoon,"onUpdate:modelValue":x=>o.value.schedule[l].afternoon=x},{default:t(()=>e[18]||(e[18]=[d("下午")])),_:2,__:[18]},1032,["modelValue","onUpdate:modelValue"])])),64))]),_:1}),a(i,null,{default:t(()=>[a(f,{type:"primary",onClick:T},{default:t(()=>e[19]||(e[19]=[d("保存")])),_:1,__:[19]}),a(f,{onClick:e[9]||(e[9]=l=>y.value=!1)},{default:t(()=>e[20]||(e[20]=[d("取消")])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ce=_e(we,[["__scopeId","data-v-d38ed6e6"]]);export{Ce as default};
