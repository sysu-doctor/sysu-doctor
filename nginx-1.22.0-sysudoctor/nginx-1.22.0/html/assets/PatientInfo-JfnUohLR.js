import{d as R,r as y,b as q,U as F,o as T,j as f,i as m,h as a,w as l,f as u,p as d,l as W,v as $,t as c,a as G,E as v,u as H,g as b,V as J,_ as K}from"./index-CNVEcACA.js";import{_ as k}from"./request-CwFpdHqZ.js";import{u as U}from"./index.es-AM15teyr.js";const O={class:"patient-info-container"},Q={class:"header"},X={key:0,class:"loading-container"},Z={key:1,class:"content"},ee={class:"actions"},ae=["src"],le={key:1,class:"el-icon-plus avatar-uploader-icon"},te="/vite.svg",oe=R({__name:"PatientInfo",setup(ne){const w=H(),V=y(!0),n=y({phone:F.value,name:q.value,gender:"",birth_date:"",address:"",medical_history:"",avatar_url:""}),p=y(!1),t=y({phone:n.value.phone,name:n.value.name,gender:n.value.gender||"",birth_date:n.value.birth_date||"",address:n.value.address||"",medical_history:n.value.medical_history||"",avatar_url:n.value.avatar_url||""}),{runAsync:x}=U(()=>k.get("/api/patient/"),{manual:!0});T(async()=>{try{const o=await x();n.value=o.data.data,t.value={...n.value},V.value=!1}catch{V.value=!1}});const C=()=>{w.push(J.value||"/")},M=()=>{p.value=!0},{runAsync:A}=U(o=>k.put("/api/patient/patient_manage",o),{manual:!0}),I=async()=>{try{await A(t.value),n.value={...t.value},G.value=t.value.avatar_url,p.value=!1,v.success("信息修改成功")}catch(o){const e=o&&typeof o=="object"&&"data"in o&&o.data&&typeof o.data=="object"&&"msg"in o.data?o.data.msg:"修改信息失败";v.error(e)}},P=o=>{o.code===1?(t.value.avatar_url=o.data.file_url,v.success("头像上传成功")):v.error(o.msg||"头像上传失败")},B=o=>{const e=o.type.startsWith("image/"),r=o.size/1024/1024<2;return e||v.error("上传的文件必须是图片格式"),r||v.error("上传的图片大小不能超过 2MB"),e&&r};return(o,e)=>{const r=u("el-button"),D=u("el-icon"),E=u("el-avatar"),_=u("el-descriptions-item"),N=u("el-descriptions"),Y=u("el-upload"),i=u("el-form-item"),g=u("el-input"),h=u("el-option"),j=u("el-select"),z=u("el-date-picker"),S=u("el-form"),L=u("el-dialog");return b(),f("div",O,[m("div",Q,[a(r,{type:"text",onClick:C,class:"back-button"},{default:l(()=>e[8]||(e[8]=[m("i",{class:"el-icon-arrow-left"},null,-1),d(" 返回主页 ")])),_:1,__:[8]}),e[9]||(e[9]=m("h2",{class:"title"},"患者信息",-1))]),V.value?(b(),f("div",X,[a(D,{class:"loading-icon",size:40},{default:l(()=>[a(W($))]),_:1}),e[10]||(e[10]=m("p",null,"正在加载...",-1))])):(b(),f("div",Z,[a(E,{src:n.value.avatar_url||te,class:"avatar"},null,8,["src"]),a(N,{border:"",column:"2",class:"descriptions"},{default:l(()=>[a(_,{label:"姓名"},{default:l(()=>[d(c(n.value.name),1)]),_:1}),a(_,{label:"电话"},{default:l(()=>[d(c(n.value.phone),1)]),_:1}),a(_,{label:"性别"},{default:l(()=>[d(c(n.value.gender==="male"?"男":n.value.gender==="female"?"女":"未填写"),1)]),_:1}),a(_,{label:"出生日期"},{default:l(()=>[d(c(n.value.birth_date?new Date(n.value.birth_date).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"未填写"),1)]),_:1}),a(_,{label:"地址"},{default:l(()=>[d(c(n.value.address||"未填写"),1)]),_:1}),a(_,{label:"病史"},{default:l(()=>[d(c(n.value.medical_history||"未填写"),1)]),_:1})]),_:1})])),m("div",ee,[a(r,{type:"primary",onClick:M,class:"edit-button"},{default:l(()=>e[11]||(e[11]=[m("i",{class:"el-icon-edit"},null,-1),d(" 修改信息 ")])),_:1,__:[11]})]),a(L,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=s=>p.value=s),title:"修改患者信息",width:"500px",center:"true"},{footer:l(()=>[a(r,{onClick:e[6]||(e[6]=s=>p.value=!1)},{default:l(()=>e[12]||(e[12]=[d("取消")])),_:1,__:[12]}),a(r,{type:"primary",onClick:I},{default:l(()=>e[13]||(e[13]=[d("保存")])),_:1,__:[13]})]),default:l(()=>[a(i,{label:"头像"},{default:l(()=>[a(Y,{class:"avatar-uploader",action:"/api/upload/picture","show-file-list":!1,"on-success":P,"before-upload":B},{default:l(()=>[t.value.avatar_url?(b(),f("img",{key:0,src:t.value.avatar_url,class:"avatar"},null,8,ae)):(b(),f("i",le))]),_:1})]),_:1}),a(S,{model:t.value},{default:l(()=>[a(i,{label:"姓名"},{default:l(()=>[a(g,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.name=s),readonly:""},null,8,["modelValue"])]),_:1}),a(i,{label:"电话"},{default:l(()=>[a(g,{modelValue:t.value.phone,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.phone=s),readonly:""},null,8,["modelValue"])]),_:1}),a(i,{label:"性别"},{default:l(()=>[a(j,{modelValue:t.value.gender,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.gender=s),placeholder:"请选择性别"},{default:l(()=>[a(h,{label:"男",value:"male"}),a(h,{label:"女",value:"female"})]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"出生日期"},{default:l(()=>[a(z,{modelValue:t.value.birth_date,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.birth_date=s),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(i,{label:"地址"},{default:l(()=>[a(g,{modelValue:t.value.address,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.address=s)},null,8,["modelValue"])]),_:1}),a(i,{label:"病史"},{default:l(()=>[a(g,{modelValue:t.value.medical_history,"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.medical_history=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),re=K(oe,[["__scopeId","data-v-b4dacb25"]]);export{re as default};
