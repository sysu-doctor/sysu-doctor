import{d as J,r as c,o as Q,R as $,S as D,j as A,i as y,h as a,F as G,y as H,w as l,f as m,u as K,g as h,L as W,n as X,O as C,p as F,T as L,z as S,b as T,s as z,U as E,a as N,E as p,_ as Y}from"./index-CNVEcACA.js";import{_ as f}from"./request-CwFpdHqZ.js";import{u as _}from"./index.es-AM15teyr.js";const ee="/triangle-1VJfj.png",ae={class:"auth-container"},le={class:"background-images"},oe=J({__name:"AuthForm",setup(te){const w=K(),v=c("login"),g=c(0),b=["/banner1-Vjwxq.jpg","/banner2-38SxR.jpg","/banner3-1mewp.jpg","/banner4-1PVrZ.jpg","/banner5-Zs5PL.jpg","/banner6-8RupQ.jpg","/banner7-4nOz3.jpg"];let V=null;const s=c({role:"",phone:"",password:""}),u=c({role:"",name:"",phone:"",password:""}),{runAsync:B}=_(n=>f.post("/api/patient/login",n),{manual:!0}),{runAsync:M}=_(n=>f.post("/api/doctor/login",n),{manual:!0}),{runAsync:P}=_(n=>f.post("/api/patient/register",n),{manual:!0}),{runAsync:q}=_(n=>f.post("/api/doctor/register",n),{manual:!0});async function j(){var n;try{const{phone:e,password:d}=s.value;if(s.value.role==="doctor"){const o=await M({phone:e,password:d});L.value=o.data.data.token,S.value=o.data.data.id,T.value=o.data.data.name,z.value=o.data.data.role,E.value=e,N.value=o.data.data.avatar_url,p.success("医生登录成功"),w.push("/")}else if(s.value.role==="patient"){const o=await B({phone:e,password:d});L.value=o.data.data.token,S.value=o.data.data.id,T.value=o.data.data.name,z.value=o.data.data.role,E.value=e,N.value=o.data.data.avatar_url,p.success("患者登录成功"),w.push("/")}else p.error("请选择身份")}catch(e){typeof e=="object"&&e!==null&&"data"in e?p.error(((n=e.data)==null?void 0:n.msg)||"请求失败"):p.error("请求失败")}}async function k(){var n;try{const{role:e,name:d,phone:o,password:r}=u.value;e==="doctor"?(await q({name:d,phone:o,password:r}),p.success("医生注册成功，请登录"),v.value="login"):e==="patient"?(await P({name:d,phone:o,password:r}),p.success("患者注册成功，请登录"),v.value="login"):p.error("请选择身份")}catch(e){typeof e=="object"&&e!==null&&"data"in e?p.error(((n=e.data)==null?void 0:n.msg)||"请求失败"):p.error("请求失败")}}Q(()=>{$(),b.forEach(n=>{const e=new Image;e.src=n}),O()}),D(()=>{V&&clearInterval(V)});const O=()=>{V=setInterval(()=>{g.value=(g.value+1)%b.length},4e3)};return(n,e)=>{const d=m("el-option"),o=m("el-select"),r=m("el-form-item"),i=m("el-input"),R=m("el-button"),U=m("el-form"),I=m("el-tab-pane"),Z=m("el-tabs");return h(),A("div",ae,[y("div",le,[(h(),A(G,null,H(b,(t,x)=>y("div",{key:x,class:X(["bg-image",{active:g.value===x}]),style:W({backgroundImage:`url(${t})`})},null,6)),64))]),e[10]||(e[10]=y("img",{src:ee,alt:"覆盖图片",class:"overlay-image"},null,-1)),a(Z,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value=t)},{default:l(()=>[a(I,{label:"登录",name:"login"},{default:l(()=>[a(U,{model:s.value,onSubmit:C(j,["prevent"])},{default:l(()=>[a(r,{label:"身份"},{default:l(()=>[a(o,{modelValue:s.value.role,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.role=t),placeholder:"请选择身份"},{default:l(()=>[a(d,{label:"医生",value:"doctor"}),a(d,{label:"患者",value:"patient"})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"电话"},{default:l(()=>[a(i,{modelValue:s.value.phone,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.phone=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(r,{label:"密码"},{default:l(()=>[a(i,{modelValue:s.value.password,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.password=t),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(r,null,{default:l(()=>[a(R,{type:"primary",onClick:j},{default:l(()=>e[8]||(e[8]=[F("登录")])),_:1,__:[8]})]),_:1})]),_:1},8,["model"])]),_:1}),a(I,{label:"注册",name:"register"},{default:l(()=>[a(U,{model:u.value,onSubmit:C(k,["prevent"])},{default:l(()=>[a(r,{label:"身份"},{default:l(()=>[a(o,{modelValue:u.value.role,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.role=t),placeholder:"请选择身份"},{default:l(()=>[a(d,{label:"医生",value:"doctor"}),a(d,{label:"患者",value:"patient"})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"用户名"},{default:l(()=>[a(i,{modelValue:u.value.name,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.name=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(r,{label:"电话"},{default:l(()=>[a(i,{modelValue:u.value.phone,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.phone=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(r,{label:"密码"},{default:l(()=>[a(i,{modelValue:u.value.password,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.password=t),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(r,null,{default:l(()=>[a(R,{type:"primary",onClick:k},{default:l(()=>e[9]||(e[9]=[F("注册")])),_:1,__:[9]})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])}}}),ue=Y(oe,[["__scopeId","data-v-12338849"]]);export{ue as default};
